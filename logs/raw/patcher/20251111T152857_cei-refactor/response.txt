*** Begin Patch
*** Update File: contracts/Router.sol
@@
-    IERC20 public tokenOut;
+    IERC20 public tokenOut;
+    mapping(address => uint256) public lastSwapOut;
*** End Patch
*** Begin Patch
*** Update File: contracts/Router.sol
@@
-    function swap(uint256 amountIn, uint256 minOut) external returns (uint256 amountOut) {
-        require(amountIn > 0, "zero-in");
-
-        // compute first so we can check minOut on the actual amountOut
-        amountOut = getQuote(amountIn);
-
-        // **invariant**: enforce user’s minimum acceptable output
-        require(amountOut >= minOut, "slippage");
-
-        // effects + interactions (simplified)
-        tokenIn.transferFrom(msg.sender, address(this), amountIn);
-        tokenOut.transfer(msg.sender, amountOut);
-    }
+    function swap(uint256 amountIn, uint256 minOut) external returns (uint256 amountOut) {
+        require(amountIn > 0, "zero-in");
+
+        // compute first so we can check minOut on the actual amountOut
+        amountOut = getQuote(amountIn);
+
+        // invariant: enforce user’s minimum acceptable output
+        require(amountOut >= minOut, "slippage");
+
+        // Effects: record swap details before external interactions
+        lastSwapOut[msg.sender] = amountOut;
+
+        // Interactions: external calls after state changes
+        tokenIn.transferFrom(msg.sender, address(this), amountIn);
+        tokenOut.transfer(msg.sender, amountOut);
+    }
*** End Patch